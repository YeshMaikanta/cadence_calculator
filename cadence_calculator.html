<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadence Workflow Calculator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc;
        }
        .card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .input-field {
            @apply w-full p-3 border border-gray-300 rounded-lg focus:border-indigo-500 focus:ring-indigo-500 transition duration-150;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 mb-2">Cadence & Workflow Calculator</h1>
        <p class="text-lg text-gray-600 mb-8">Enter your event details to automatically calculate all required scheduling and general tab end dates.</p>

        <!-- Input Card -->
        <div class="card bg-white p-6 sm:p-8 rounded-xl mb-10">
            <h2 class="text-2xl font-semibold mb-6 text-indigo-700">1. Event Details Input</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Start Date -->
                <div>
                    <label for="startDate" class="block text-sm font-medium text-gray-700 mb-1">Event Start Date</label>
                    <input type="date" id="startDate" class="input-field" onchange="calculateCadence()">
                </div>
                <!-- Start Time -->
                <div>
                    <label for="startTime" class="block text-sm font-medium text-gray-700 mb-1">Event Start Time</label>
                    <input type="time" id="startTime" class="input-field" step="1800" onchange="calculateCadence()">
                </div>
                <!-- End Date -->
                <div>
                    <label for="endDate" class="block text-sm font-medium text-gray-700 mb-1">Event End Date</label>
                    <input type="date" id="endDate" class="input-field" onchange="calculateCadence()">
                </div>
                <!-- End Time -->
                <div>
                    <label for="endTime" class="block text-sm font-medium text-gray-700 mb-1">Event End Time</label>
                    <input type="time" id="endTime" class="input-field" step="1800" onchange="calculateCadence()">
                </div>
            </div>

            <!-- Event Type and Checkboxes -->
            <div class="mt-8">
                <label class="block text-sm font-medium text-gray-700 mb-3">Event Type (Determines Calendar vs. Business Days)</label>
                <div class="flex flex-col sm:flex-row gap-4">
                    <label class="inline-flex items-center p-3 bg-indigo-50 rounded-lg cursor-pointer">
                        <input type="radio" name="eventType" value="Digital" checked onchange="calculateCadence()" class="text-indigo-600 focus:ring-indigo-500">
                        <span class="ml-2 text-sm font-medium text-indigo-800">Digital Event (Calendar Days)</span>
                    </label>
                    <label class="inline-flex items-center p-3 bg-indigo-50 rounded-lg cursor-pointer">
                        <input type="radio" name="eventType" value="In-Person" onchange="calculateCadence()" class="text-indigo-600 focus:ring-indigo-500">
                        <span class="ml-2 text-sm font-medium text-indigo-800">In-Person Event (Business Days)</span>
                    </label>
                </div>

                <div class="mt-6 space-y-3">
                    <label class="inline-flex items-center">
                        <input type="checkbox" id="isTLE" onchange="calculateCadence()" class="rounded text-green-600 focus:ring-green-500">
                        <span class="ml-2 text-sm font-medium text-gray-700">TLE Event with Recording Enabled (Affects Follow-up Email Date)</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="checkbox" id="isAITour" onchange="calculateCadence()" class="rounded text-green-600 focus:ring-green-500">
                        <span class="ml-2 text-sm font-medium text-gray-700">AI Tour (In-Person Only) (Affects Waitlist End Dates)</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Results Card -->
        <div class="card bg-white p-6 sm:p-8 rounded-xl">
            <h2 class="text-2xl font-semibold mb-6 text-green-700">2. Calculated Workflow Dates</h2>
            <div id="resultsTable">
                <!-- Results will be injected here by JavaScript -->
                <p class="text-center text-gray-500 mt-4">Fill out the event details above to see the cadence results.</p>
            </div>
        </div>
    </div>

    <script>
        // Helper function to check if a date is a weekend (0=Sun, 6=Sat)
        const isWeekend = (date) => {
            const day = date.getDay();
            return day === 0 || day === 6;
        };

        // Helper function to get the next date, adding the specified number of calendar days
        const addCalendarDays = (startDate, days) => {
            const date = new Date(startDate.getTime());
            date.setDate(date.getDate() + days);
            return date;
        };
        
        // Helper function to calculate the date by adding/subtracting business days
        const calculateBusinessDays = (startDate, days) => {
            let date = new Date(startDate.getTime());
            let remainingDays = Math.abs(days);
            const direction = days > 0 ? 1 : -1;

            while (remainingDays > 0) {
                date.setDate(date.getDate() + direction);
                if (!isWeekend(date)) {
                    remainingDays--;
                }
            }
            return date;
        };
        
        // Helper to format date only (YYYY-MM-DD)
        const formatDate = (date) => {
            const d = new Date(date);
            let month = '' + (d.getMonth() + 1);
            let day = '' + d.getDate();
            const year = d.getFullYear();

            if (month.length < 2) month = '0' + month;
            if (day.length < 2) day = '0' + day;

            return [year, month, day].join('-');
        };

        // Helper to format time only (HH:MM AM/PM)
        const formatTime = (date) => {
            let hours = date.getHours();
            let minutes = date.getMinutes();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12; // the hour '0' should be '12'
            minutes = minutes < 10 ? '0' + minutes : minutes;
            return `${hours}:${minutes < 10 ? '0' + minutes : minutes} ${ampm}`;
        };

        // Function to handle the special Email Expiration rule
        const getExpirationTime = (scheduledDateTime) => {
            const hours = scheduledDateTime.getHours();
            const minutes = scheduledDateTime.getMinutes();
            
            // Per the rule: "If your event time is 10:30 then please select 12:00 as email expiration time..."
            // This suggests: Target expiration is +1 hour. If target minutes are 30, it rounds up to the next full hour.
            
            const targetExpiration = new Date(scheduledDateTime.getTime());
            targetExpiration.setHours(targetExpiration.getHours() + 1);

            if (targetExpiration.getMinutes() === 30) {
                // If the target is xx:30, it requires rounding up to the next full hour (e.g. 11:30 -> 12:00)
                targetExpiration.setHours(targetExpiration.getHours() + 1);
                targetExpiration.setMinutes(0);
                return `${formatTime(targetExpiration)} <span class="text-red-500 font-semibold">(Rounded up)</span>`;
            }
            
            // For all other times, standard +1 hour
            return formatTime(targetExpiration);
        };
        
        const calculateCadence = () => {
            // 1. Get Inputs
            const startD = document.getElementById('startDate').value;
            const startT = document.getElementById('startTime').value;
            const endD = document.getElementById('endDate').value;
            const endT = document.getElementById('endTime').value;
            const type = document.querySelector('input[name="eventType"]:checked')?.value;
            const isTLE = document.getElementById('isTLE').checked;
            const isAITour = document.getElementById('isAITour').checked;

            if (!startD || !startT || !endD || !endT || !type) {
                document.getElementById('resultsTable').innerHTML = '<p class="text-center text-yellow-600 mt-4 p-4 bg-yellow-50 rounded-lg">Please fill in all required event details (Date, Time, and Type) to see the full cadence.</p>';
                return;
            }

            // Combine date and time inputs into full Date objects
            // The T separator is critical for correct parsing regardless of local timezone.
            const startDateTime = new Date(`${startD}T${startT}:00`);
            const endDateTime = new Date(`${endD}T${endT}:00`);

            const isDigital = type === 'Digital';
            const dayCalculator = isDigital ? addCalendarDays : calculateBusinessDays;
            
            const results = {};

            // --- A. Registration Workflow Cadence (Reminders & Follow-up) ---

            // 1st Reminder: T-3 days, Event Start Time
            const firstReminderDate = dayCalculator(startDateTime, isDigital ? -3 : -3);
            firstReminderDate.setHours(startDateTime.getHours(), startDateTime.getMinutes(), 0, 0);
            results.reminder1 = {
                date: formatDate(firstReminderDate),
                time: formatTime(startDateTime),
                expiration: getExpirationTime(startDateTime)
            };

            // 2nd Reminder: T-1 day, Event Start Time
            const secondReminderDate = dayCalculator(startDateTime, isDigital ? -1 : -1);
            secondReminderDate.setHours(startDateTime.getHours(), startDateTime.getMinutes(), 0, 0);
            results.reminder2 = {
                date: formatDate(secondReminderDate),
                time: formatTime(startDateTime),
                expiration: getExpirationTime(startDateTime)
            };

            // Follow up Email (TY):
            let followUpDate;
            let followUpTime = formatTime(endDateTime);
            let tyLogic;

            if (isTLE) {
                // T+6 Business days for TLE event with recording enabled (always Business days)
                followUpDate = calculateBusinessDays(endDateTime, 6);
                tyLogic = `T+6 Business Days after event end date (For TLE w/ Recording)`;
            } else {
                // Default: T+1 day (Calendar for Digital, Business for In-Person)
                followUpDate = dayCalculator(endDateTime, 1);
                tyLogic = `T+1 ${isDigital ? 'Calendar' : 'Business'} Day after event end date`;
            }
            // TY email uses Event End Time
            followUpDate.setHours(endDateTime.getHours(), endDateTime.getMinutes(), 0, 0);

            results.followUp = {
                date: formatDate(followUpDate),
                time: followUpTime,
                logic: tyLogic
            };


            // --- B. General Tab End Dates ---

            // 1. Registration Workflow End Date: TY+7 Calendar Days
            const regEndDateTime = addCalendarDays(followUpDate, 7);
            results.regEnd = {
                date: formatDate(regEndDateTime),
                time: 'Event End Time',
                logic: 'TY Email Date + 7 Calendar Days'
            };

            // 2. Registration Denied Workflow End Date: T+7 Calendar Days after Event End Date
            const regDeniedEndDateTime = addCalendarDays(endDateTime, 7);
            results.regDeniedEnd = {
                date: formatDate(regDeniedEndDateTime),
                time: 'N/A',
                logic: 'Event End Date + 7 Calendar Days'
            };

            // 3. Waitlist Workflow End Date:
            if (isAITour && !isDigital) { // Only applies to In-Person AI Tour
                // AI Tour (In-Person): Event End Date, T-3 hours before event start time
                const waitlistEndDT = new Date(endDateTime.getTime());
                // Calculate time T-3 hours before START time on the END date
                waitlistEndDT.setHours(startDateTime.getHours() - 3, startDateTime.getMinutes(), 0, 0);

                results.waitlistEnd = {
                    date: formatDate(waitlistEndDT),
                    time: formatTime(waitlistEndDT),
                    logic: 'Event End Date, T-3 hours before Event Start Time'
                };
            } else {
                // Standard/Digital/In-Person Non-AI: T+7 after the event end date (Calendar days)
                const waitlistEndDT = addCalendarDays(endDateTime, 7);
                results.waitlistEnd = {
                    date: formatDate(waitlistEndDT),
                    time: 'N/A',
                    logic: 'Event End Date + 7 Calendar Days'
                };
            }

            // 4. Waitlist Denied Workflow Start/End Dates:
            // Start Date is always T-1 Calendar days, Event Start Time
            const wlDeniedStartDT = addCalendarDays(startDateTime, -1);
            wlDeniedStartDT.setHours(startDateTime.getHours(), startDateTime.getMinutes(), 0, 0);

            let wlDeniedEndDTText, wlDeniedEndTimeText, wlDeniedEndLogic;

            if (isAITour && !isDigital) {
                // AI Tour (In-Person): Stopped
                wlDeniedEndDTText = '<span class="text-red-600 font-bold">STOPPED</span>';
                wlDeniedEndTimeText = 'N/A';
                wlDeniedEndLogic = 'AI Tour (In-Person) Events: Workflow is STOPPED.';
            } else if (isDigital) {
                // Digital: T+1 Calendar days, Event Start Time
                const wlDeniedEndDT = addCalendarDays(startDateTime, 1);
                wlDeniedEndDT.setHours(startDateTime.getHours(), startDateTime.getMinutes(), 0, 0);
                wlDeniedEndDTText = formatDate(wlDeniedEndDT);
                wlDeniedEndTimeText = formatTime(startDateTime);
                wlDeniedEndLogic = 'T+1 Calendar Days, Event Start Time';
            } else {
                // In-Person: T-3 hours before event start date and time
                const wlDeniedEndDT = new Date(startDateTime.getTime());
                wlDeniedEndDT.setHours(startDateTime.getHours() - 3, startDateTime.getMinutes(), 0, 0);
                wlDeniedEndDTText = formatDate(wlDeniedEndDT);
                wlDeniedEndTimeText = formatTime(wlDeniedEndDT);
                wlDeniedEndLogic = 'T-3 hours before Event Start Date and Time';
            }

            results.wlDeniedStart = {
                date: formatDate(wlDeniedStartDT),
                time: formatTime(startDateTime),
                logic: 'T-1 Calendar Days, Event Start Time'
            };
            results.wlDeniedEnd = {
                date: wlDeniedEndDTText,
                time: wlDeniedEndTimeText,
                logic: wlDeniedEndLogic
            };


            // 5. Render Results
            renderResults(results, isDigital, isTLE, isAITour);
        };

        const renderResults = (results, isDigital, isTLE, isAITour) => {
            const dayBasis = isDigital ? 'Calendar Day' : 'Business Day';
            let html = '';

            // --- Registration Workflow Cadence Table ---
            html += `
                <h3 class="text-xl font-semibold mt-4 mb-4 text-indigo-700">Registration Workflow Cadence (Reminders & Follow-up)</h3>
                <p class="text-sm text-gray-500 mb-4 bg-indigo-50 p-3 rounded-lg">Calculation Basis: <span class="font-bold text-indigo-800">${dayBasis}</span></p>
                <div class="overflow-x-auto mb-8">
                    <table class="min-w-full bg-white border border-gray-200 rounded-lg shadow-sm">
                        <thead class="bg-indigo-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Email</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Cadence Logic</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Required Date</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Required Time</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Email Expiration</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            <tr>
                                <td class="px-4 py-4 whitespace-nowrap font-medium text-gray-900">1st Reminder</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-600">T-3 ${dayBasis}s</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-green-700 font-bold">${results.reminder1.date}</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-600">${results.reminder1.time}</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-600">${results.reminder1.expiration}</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-4 whitespace-nowrap font-medium text-gray-900">2nd Reminder</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-600">T-1 ${dayBasis}</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-green-700 font-bold">${results.reminder2.date}</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-600">${results.reminder2.time}</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-600">${results.reminder2.expiration}</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-4 whitespace-nowrap font-medium text-gray-900">Follow-up (TY)</td>
                                <td class="px-4 py-4 whitespace-pre-wrap text-sm text-gray-600">${results.followUp.logic}</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-green-700 font-bold">${results.followUp.date}</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-600">${results.followUp.time}</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-600">N/A</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
            
            // --- General Tab End Dates Table ---
            html += `
                <h3 class="text-xl font-semibold mt-8 mb-4 text-green-700">General Tab End Dates</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white border border-gray-200 rounded-lg shadow-sm">
                        <thead class="bg-green-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Workflow</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">End Date Logic</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">End Date</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">End Time</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            <tr>
                                <td class="px-4 py-4 whitespace-nowrap font-medium text-gray-900">Registration</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-600">${results.regEnd.logic}</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-green-700 font-bold">${results.regEnd.date}</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-600">7-day period is generally on the End Date.</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-4 whitespace-nowrap font-medium text-gray-900">Registration Denied</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-600">${results.regDeniedEnd.logic}</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-green-700 font-bold">${results.regDeniedEnd.date}</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-600">N/A (Uses Event End Date time)</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-4 whitespace-nowrap font-medium text-gray-900">Waitlist</td>
                                <td class="px-4 py-4 whitespace-pre-wrap text-sm text-gray-600">${results.waitlistEnd.logic}</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-green-700 font-bold">${results.waitlistEnd.date}</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-600">${results.waitlistEnd.time}</td>
                            </tr>
                            <tr class="${(isAITour && !isDigital) ? 'bg-red-50' : ''}">
                                <td class="px-4 py-4 whitespace-nowrap font-medium text-gray-900">Waitlist Denied - Start</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-600">${results.wlDeniedStart.logic}</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-green-700 font-bold">${results.wlDeniedStart.date}</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-600">${results.wlDeniedStart.time}</td>
                            </tr>
                            <tr class="${(isAITour && !isDigital) ? 'bg-red-100' : ''}">
                                <td class="px-4 py-4 whitespace-nowrap font-medium text-gray-900">Waitlist Denied - End</td>
                                <td class="px-4 py-4 whitespace-pre-wrap text-sm text-gray-600">${results.wlDeniedEnd.logic}</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm ${results.wlDeniedEnd.date.includes('STOPPED') ? 'text-red-600' : 'text-green-700'} font-bold">${results.wlDeniedEnd.date}</td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-600">${results.wlDeniedEnd.time}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
            document.getElementById('resultsTable').innerHTML = html;
        };

        // Initialize with today's date and a sample time for a good first experience
        window.onload = () => {
            const today = formatDate(new Date());
            document.getElementById('startDate').value = today;
            document.getElementById('endDate').value = today;
            document.getElementById('startTime').value = '10:30';
            document.getElementById('endTime').value = '16:00';
            calculateCadence();
        };

    </script>
</body>
</html>